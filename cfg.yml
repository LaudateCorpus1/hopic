version:
  tag:    'v{version.major}.{version.minor}.{version.patch}'
  format: semver

scm:
  git:
    worktrees:
      doc/build/html: pages

phases:
  build:
    sphinx-doc:
      - rm -rf doc/build/venv
      - python -m virtualenv --clear doc/build/venv
      - doc/build/venv/bin/python -m pip install setuptools_scm . -r doc-requirements.txt
      - archive:
          artifacts: doc/build/html/**
        worktrees:
          doc/build/html:
            commit-message: "Update documentation for ${VERSION}"
        sh: doc/build/venv/bin/python -m sphinx.cmd.build -b html -d doc/build/doctrees doc/source doc/build/html
