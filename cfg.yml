image: !image-from-ivy-manifest
  repository: hub.docker.com
  path: tomtom

volumes:
  - source: ${CT_DEVENV_HOME}
    target: /tools/devenv
    read_only: yes
  - ~/.ccache:/home/sandbox/.ccache:rw
  - ~/.ivy2:/home/sandbox/.ivy2:rw
  - .:/code/ci-config:ro

##checks:
##  - pull-request-checker:
##    - jira-project: CARU
##      parameter1: aaa
##      parameter2: bbb
##  - pull-request-approval-check:

phases:
  build:
    Linux-x86_64-Release:
      - Build/build.py -f Build/Linux-x86_64.yaml -m Release
    Linux-x86_64-Debug:
      - Build/build.py -f Build/Linux-x86_64.yaml -m Debug
    Linux_AGL-aarch64-Release:
      - Build/build.py -f Build/Linux_AGL-aarch64.yaml -m Release
    Linux_AGL-aarch64-Debug:
      - Build/build.py -f Build/Linux_AGL-aarch64.yaml -m Debug

  test:
    Linux-x86_64-Release:
      - description: Run unit tests
      - Build/build.py -f Build/Linux-x86_64.yaml -m Release DBusTests_Run_SmokeTests
      - clazy-standalone.sh Components Build/Output/Linux-x86_64/Release
    Linux-x86_64-Debug:
      - description: Run unit tests
      - Build/build.py -f Build/Linux-x86_64.yaml -m Debug test-v
      - clazy-standalone.sh Components Build/Output/Linux-x86_64/Debug

  publish:
    Linux_AGL-aarch64-Release:
      - Build/build.py -f Build/Linux_AGL-aarch64.yaml -m Release publish-rc
    Linux-x86_64-Release:
      - Build/build.py -f Build/Linux-x86_64.yaml -m Release publish-rc
